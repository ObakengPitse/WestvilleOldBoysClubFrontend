@{
    ViewData["Title"] = "Statistics";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Stats Hub: Deeper Insights</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Chart.js for donut chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body { background:#f4f6f9; }
    .sidebar { background:#193b5f; color: #fff; min-height:100vh; }
    .sidebar a{ color:#cfe3f6; text-decoration:none; display:block; padding:.75rem 1rem }
    .sidebar a:hover{ background: rgba(255,255,255,0.03); color:#fff }
    .card { border-radius:.6rem }
    .live-badge { background:#ff4d4f; color:#fff; padding:.2rem .5rem; border-radius:.4rem; font-weight:600 }
    .small-muted { color:#6c757d; font-size:.9rem }
    
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row g-0">
    <!-- Sidebar -->
    <aside class="col-12 col-md-3 col-lg-2 sidebar p-4 d-flex flex-column">
      <h5 class="fw-bold">Westville Old Boys<br><small class="fw-normal">Club</small></h5>
      <nav class="mt-4 flex-grow-1">
        <a asp-controller="Home" asp-action="Index">Home</a>
        <a asp-controller="Home" asp-action="Statistics">Statistics</a>
        <a asp-controller="Home" asp-action="Resturant">Restaurant</a>
      </nav>
      <div class="mt-3 small-muted">© Stats Hub</div>
    </aside>

    <!-- Main content -->
    <main class="col p-4">
      <div class="container-fluid">
        <div class="row align-items-center mb-3">
          <div class="col-12 col-md-8">
            <h2 class="mb-0">Stats Hub: Deeper Insights</h2>
            <p class="small-muted mb-0">Dive into the heart of the beautiful game. Experience the thrill of real-time
              live match updates and feel every goal, save, and tactical shift as if you're in the stadium.</p>
          </div>
          <div class="col-12 col-md-4 text-md-end mt-3 mt-md-0">
            <div class="card p-3 d-inline-block" style="min-width:200px">
              <strong>Sideline</strong>
              <div class="small-muted">Your Ultimate Football Companion! Stay updated with live scores, news, and team updates</div>
            </div>
          </div>
        </div>

        <div class="row g-3">
          <!-- Left column widgets -->
          <div class="col-12 col-lg-7">
            <div class="row g-3">
              <div class="col-12">
                <div class="card p-3" id="overviewCard">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="mb-0">OVERALL</h6>
                    <div class="small-muted" id="seasonPerf">Season Performance</div>
                  </div>
                  <div class="row">
                    <div class="col-5 d-flex justify-content-center align-items-center">
                      <canvas id="overallChart" style="max-width:180px"></canvas>
                    </div>
                    <div class="col-7">
                      <ul class="list-unstyled" id="overallLegend"></ul>
                      <div class="small-muted mt-2" id="overallSummary">Loading...</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <div class="card p-3" id="leaguesCard">
                  <h6>ALL Leagues</h6>
                  <div id="leaguesList" class="mt-2"></div>
                </div>
              </div>

              <div class="col-12">
                <div class="card p-3 text-center" id="featureMatchCard">
                  <h6 class="mb-3">Real Madrid VS FC Barcelona</h6>
                  <div class="row align-items-center">
                    <div class="col-5 text-center">
                      <img src="https://www.gstatic.com/onebox/sports/logos/inverse-crest.svg" alt="rm" class="mb-2"><br>
                      <small class="d-block" id="teamAName">Real Madrid</small>
                    </div>
                    <div class="col-2">
                      <strong id="vsScore">VS</strong>
                    </div>
                    <div class="col-5 text-center">
                      <img src="https://www.gstatic.com/onebox/sports/logos/inverse-crest.svg" alt="fb" class="mb-2"><br>
                      <small class="d-block" id="teamBName">FC Barcelona</small>
                    </div>
                  </div>
                  <div class="mt-3 small-muted" id="featureMatchDate">02 November 2025 - Comp Nou Barcelona</div>
                </div>
              </div>

              <div class="col-12">
                <div class="card p-3" id="newsCard">
                  <h6>Latest News</h6>
                  <div id="newsList" class="mt-2 small-muted">Loading news...</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right column -->
          <div class="col-12 col-lg-5">
            <div class="row g-3">
              <div class="col-12">
                <div class="card p-3">
                  <h6>Previous Matches</h6>
                  <div id="prevMatches" class="mt-2 small-muted">Loading...</div>
                </div>
              </div>

              <div class="col-12">
                <div class="card p-3 d-flex align-items-center">
                  <h6>LaLiga Match <span class="live-badge ms-2" id="liveBadge">LIVE</span></h6>
                  <div class="w-100 d-flex align-items-center justify-content-between mt-3">
                    <div class="d-flex align-items-center">
                      <img src="https://www.gstatic.com/onebox/sports/logos/inverse-crest.svg" id="liveTeamAImg" class="me-2">
                      <div><strong id="liveTeamA">Athletico Madrid</strong><div class="small-muted">15'</div></div>
                    </div>
                    <div><h3 id="liveScore">1-0</h3></div>
                    <div class="d-flex align-items-center">
                      <div class="text-end"><strong id="liveTeamB">Fc Porto</strong><div class="small-muted">--'</div></div>
                      <img src="https://www.gstatic.com/onebox/sports/logos/inverse-crest.svg" id="liveTeamBImg" class="ms-2">
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <div class="card p-3">
                  <div class="d-flex justify-content-between">
                    <h6>Top Scorer</h6>
                  </div>
                  <div class="mt-2" id="topScorer">Loading...</div>
                </div>
              </div>

              <div class="col-12">
                <div class="card p-3">
                  <h6>Standings</h6>
                  <div class="table-responsive mt-2">
                    <table class="table table-sm mb-0" id="standingsTable">
                      <thead>
                        <tr>
                          <th>club</th><th>NP</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>Pts</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <div class="card p-3">
                  <h6>Players</h6>
                  <ul class="list-unstyled mb-0" id="playersList"></ul>
                </div>
              </div>

            </div>
          </div>

        </div>

      </div>
    </main>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// ------------------ Utilities ------------------
const API = {
  overview: '/api/overview',
  leagues: '/api/leagues',
  previousMatches: '/api/matches/previous',
  liveMatch: '/api/matches/live',
  topScorer: '/api/topscorer',
  standings: '/api/standings',
  news: '/api/news',
  players: '/api/players',
};

async function fetchJson(url){
  try{
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error('Network response not ok');
    return await res.json();
  }catch(err){
    console.warn('Fetch failed for', url, err);
    return null;
  }
}

// ------------------ Chart ------------------
let overallChart = null;
function renderOverallChart(data){
  const ctx = document.getElementById('overallChart');
  const labels = data.labels || ['Wins','Draws','Losses','Other'];
  const values = data.values || [40,30,15,15];

  if(overallChart) overallChart.destroy();
  overallChart = new Chart(ctx, {
    type: 'doughnut',
    data: { labels, datasets: [{ data: values, weight:10 }]},
    options: { plugins:{legend:{display:false}}, cutout: '70%' }
  });

  const legend = document.getElementById('overallLegend');
  legend.innerHTML = labels.map((l,i)=>`<li><span class="me-2">■</span>${l} (${Math.round(values[i])}%)</li>`).join('');
}

// ------------------ Renderers ------------------
async function loadOverview(){
  const data = await fetchJson(API.overview) || {
    labels:['Wins','Draws','Losses','Other'], values:[40,30,15,15], summary:'28 Wins · 12 Draws · 6 Losses'
  };
  renderOverallChart({labels:data.labels, values:data.values});
  document.getElementById('overallSummary').textContent = data.summary || '';
}

async function loadLeagues(){
  const data = await fetchJson(API.leagues) || { leagues: ['La Liga','Premier League','Bundesliga','Other'] };
  const container = document.getElementById('leaguesList');
  container.innerHTML = data.leagues.map(l=>`<div class="py-2 border-bottom">${l}</div>`).join('');
}

async function loadPrevMatches(){
  const data = await fetchJson(API.previousMatches) || { matches: [ {title:'Matchday 37 of 37', teams:'Athletico vs Griezmann Islands'}, {title:'Matchday 36 of 37', teams:'Althéric vs Borg Iglesias Indibles'} ] };
  const el = document.getElementById('prevMatches');
  el.innerHTML = data.matches.map(m=>`<div class="mb-2"><strong>${m.title}</strong><div class="small-muted">${m.teams}</div></div>`).join('');
}

async function loadLiveMatch(){
  const data = await fetchJson(API.liveMatch) || {
    live: true, teamA:'Athletico Madrid', teamB:'Fc Porto', score:'1-0', minute:"15'"
  };
  document.getElementById('liveBadge').style.display = data.live ? 'inline-block' : 'none';
  document.getElementById('liveTeamA').textContent = data.teamA;
  document.getElementById('liveTeamB').textContent = data.teamB;
  document.getElementById('liveScore').textContent = data.score;
  // images if provided
  if(data.teamAImg) document.getElementById('liveTeamAImg').src = data.teamAImg;
  if(data.teamBImg) document.getElementById('liveTeamBImg').src = data.teamBImg;
}

async function loadTopScorer(){
  const data = await fetchJson(API.topScorer) || { name:'Antoine Griezmann', goals:23 };
  document.getElementById('topScorer').innerHTML = `<div><strong>${data.name}</strong><div class="small-muted">${data.goals} Goals</div></div>`;
}

async function loadStandings(){
  const data = await fetchJson(API.standings) || { table:[ {club:'Barcelona', NP:36, W:28,D:4,L:4, GF:49,GA:18, Pts:88}, {club:'Real Madrid', NP:36, W:24,D:5,L:7, GF:74,GA:35, Pts:77} ] };
  const tbody = document.querySelector('#standingsTable tbody');
  tbody.innerHTML = data.table.map(r=>`<tr><td>${r.club}</td><td>${r.NP}</td><td>${r.W}</td><td>${r.D}</td><td>${r.L}</td><td>${r.GF}</td><td>${r.GA}</td><td>${r.Pts}</td></tr>`).join('');
}

async function loadNews(){
  const data = await fetchJson(API.news) || { items: [ {title:'Golden Shoe 2022-23: top scorers', excerpt:'The race is an once more...'},{title:'Hazard & Madrid\'s worst signings ever ranked', excerpt:'Eden Hazard...'} ] };
  document.getElementById('newsList').innerHTML = data.items.map(i=>`<div class="mb-2"><strong>${i.title}</strong><div class="small-muted">${i.excerpt}</div></div>`).join('');
}

async function loadPlayers(){
  const data = await fetchJson(API.players) || { players: [ {name:'Karim Benzema', club:'Real Madrid'}, {name:'Raphinha', club:'Barcelona'}, {name:'Koke', club:'Athletico Madrid'} ] };
  document.getElementById('playersList').innerHTML = data.players.map(p=>`<li class="py-2 border-bottom"><div class="d-flex justify-content-between"><span>${p.name}</span><small class="small-muted">${p.club}</small></div></li>`).join('');
}

// ------------------ Init / periodic refresh ------------------
async function refreshAll(){
  await Promise.all([
    loadOverview(),
    loadLeagues(),
    loadPrevMatches(),
    loadLiveMatch(),
    loadTopScorer(),
    loadStandings(),
    loadNews(),
    loadPlayers()
  ]);
}

// initial load
refreshAll();
// refresh live-sensitive info more often
setInterval(loadLiveMatch, 15000); // every 15s
setInterval(loadTopScorer, 30000);
setInterval(loadStandings, 60000);
// periodic full refresh
setInterval(refreshAll, 120000); // every 2 minutes

// Ticket button handler (example)
document.getElementById('ticketBtn').addEventListener('click', ()=>{
  // example POST to server to create ticket reservation
  fetch('/api/tickets', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({matchId: 1})})
    .then(r=>{ if(r.ok) alert('Ticket reserved (demo)'); else alert('Failed to reserve ticket'); })
    .catch(e=>alert('Ticket request failed'));
});

</script>
</body>
</html>

